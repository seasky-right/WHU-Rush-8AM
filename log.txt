12-15-16-55 issue1:地图缩放会直接导致分辨率降低而非正常缩放
12-15-16-56 issue1 solve;地图缩放实现
12-15-16-58 鼠标拖动地图实现
12-15-17-29 悬停动画实现
12-15-17-33 issue2:在选中某些悬停节点后拖动地图会导致闪退
12-15-18-52 issue2 solve;悬停动画实现
    好。简短说明发生了什么及为什么修复后不再崩溃：

    - 症状与触发点  
    多次点击/拖动时程序在清理悬停气泡或动画期间崩溃，调用栈指向 QObject::disconnect / clearHoverItems，说明是对已删除/无效 QObject 的信号/槽或 disconnect 操作导致的竞态/use-after-free。

    - 根本原因  
    1) 动画和 lambda 回调持有或访问了悬停项的裸指针（或错误类型的 QPointer），当用户快速切换/删除这些项时回调会访问已销毁对象。  
    2) clearHoverItems 在删除项与停止动画的顺序或方式上不安全（显式 disconnect 对已经半销毁的 QObject 会触发问题）。  
    3) 为了实现动画有时直接遍历 hoverItems，也会在项被删除同时遍历导致未定义行为。还有一些编译问题（如错误使用 QPointer<QGraphicsItem> 与 auto 类型推断）被同时修复。

    - 采取的修复措施（关键点）  
    1) 为每个悬停图元分配唯一 UID（存入 item->data(1000)），动画/回调按 UID 在 scene 中查找当前项，而不是存裸指针。这样回调即使在项被删除后也不会访问悬空指针。  
    2) 动画用 QPointer<QVariantAnimation> 管理，停止时调用 stop() 并 deleteLater()，不再直接调用 disconnect()，避免在并发删除时触发 QObject::disconnect 崩溃。  
    3) startHoverAppearAnimation 先快照 UID 列表（targets），每帧通过 UID 查找并更新项，避免并发修改 hoverItems 导致迭代器失效。  
    4) 在 mousePressEvent 里先 clearHoverItems() 再发射节点点击，避免点击处理与悬停动画删除并行产生竞态。  
    5) 修正了类型/编译问题（去掉错误的 QPointer 用法、把 auto 改为明确类型或正确的迭代方式）。

    - 结果与建议  
    - 结果：当前实现已消除之前的崩溃风险，复现步骤下不再直接闪退。  
    - 建议：若要更稳健可把气泡元素封装到单个 QGraphicsObject 容器并用 QPointer 跟踪容器生命周期；减少每帧调用 scene->items()（性能/稳定性优化）；或在拖动时临时禁用动画以降低竞态概率。

12-15-19-00 实现气泡元素的封装
    **简短结论**：崩溃是由于悬停气泡相关的动画/回调在对象已被删除时仍访问其裸指针（或错误类型的 QPointer）并执行 disconnect/操作导致的竞态/Use‑After‑Free。修复通过统一生命周期、用 UID/安全指针替代裸指针和调整删除顺序消除了这个竞态。

    - **根本原因**：动画 lambda /回调捕获或持有对 `QGraphicsItem` /相关 QObject 的裸指针，快速切换/拖动时这些对象被删除，回调再访问就触发未定义行为（堆栈指向 `QObject::disconnect`）。
    - **触发场景**：连续快速悬停、点选、拖动或在动画进行中删除悬停项时容易复现。
    - **主要修复**：
    - **封装生命周期**：把气泡合并为单一的 `HoverBubble`（`QGraphicsObject`），把相关绘制与状态聚合到一个对象里，减少跨对象引用。HoverBubble.h / HoverBubble.cpp
    - **UID + 场景查找**：给每个悬停项分配 UID（`item->data(1000)`），动画回调按 UID 在 `scene` 中查找当前项而不是持有裸指针，避免悬空访问。MapWidget.cpp
    - **安全的动画管理**：用 `QPointer<QVariantAnimation>` 存动画，停止时调用 `stop()` + `deleteLater()`，不做不安全的 `disconnect()`。动画回调也不直接持有被动画对象的裸指针。
    - **删除顺序与防护**：`clearHoverItems()` 先恢复隐藏标签，再停止/删除动画，最后移除并 delete 悬停项，避免在删除过程中触发回调访问半销毁对象。
    - **事件次序调整**：在 `mousePressEvent()` 中先 `clearHoverItems()` 再发射点击信号，避免并发删除导致竞态。
    - 已把新文件加入构建，解决链接错误（CMakeLists.txt 已更新）。
    - **为什么现在安全**：回调不再直接访问已删除对象（用 UID 查找或 QPointer），动画的生命周期由对象拥有或安全管理，删除顺序保证不会在对象半销毁时做 disconnect/访问，因而消除了崩溃触发点。
    - **建议的下一步**（可选）：
    - 将逐帧 UID 查找的动画替换为对 `HoverBubble` 的 `QPropertyAnimation`（直接动画 `opacity` / scale），更简单且更安全。
    - 优化性能：减少每帧 `scene->items()` 扫描，必要时缓存 QPointer 或直接对 `HoverBubble` 做属性动画。

12-15-19-23 完成整个悬停气泡动画
12-19 对项目进行了全方位的重构与升级，涵盖了底层架构分离、编辑器功能补全、视觉风格重塑（iOS化）以及核心稳定性修复。以下是所有修改的详细总结：

1. 架构重构 (Architecture)
双窗口分离：将项目拆分为“导航端”和“编辑端”。

MainWindow：专注于用户导航、路线搜索和展示。

EditorWindow：独立的新窗口，专注于地图数据的增删改查。

共享数据：两者共享同一个 GraphModel 实例，确保编辑后的数据能实时反映在导航中。

数据结构升级：

在 GraphData.h 中引入了强类型枚举 (enum class)：NodeType（可见/幽灵）、NodeCategory（功能分类）、EdgeType（道路类型），替代了原先不安全的 int 和 string。

生命周期管理：

在 MapWidget 中引入了严格的图形项管理机制（hoverItems, dyingItems, editTempItems），废弃了基于 Z-Value 的粗暴查找，转为指针追踪。

2. 功能增强 (Features)
全功能地图编辑器：

三种模式：连线模式、新建建筑、新建路口（幽灵节点）。

CRUD 操作：支持节点和边的添加、删除、属性修改（名称、高度、分类等）。

交互优化：

连线：点选起点 -> 悬停预览虚线 -> 点选终点建立连接。

拖拽：按住 Ctrl + 左键可拖动节点位置。

撤销：右键撤销上一步新建/删除操作。

保存：支持将修改后的数据写回 nodes.txt 和 edges.txt。

导航系统修复：

修复了“无可行路线”的 Bug（由数据加载逻辑未适配 Enum 导致）。

恢复了多策略寻路（最短距离、最快时间、最少代价）。

3. UI/UX 视觉重塑 (iOS Design Language)
色彩系统：

背景：使用 Apple 官方的 System Grouped Background (#F5F5F7)，柔和护眼。

交互色：统一使用 System Blue (#007AFF) 作为选中、连接、高亮的主色调。

层级：通过颜色深浅（System Gray 4/5/6）区分普通道路、节点和幽灵节点。

节点与光效：

雷达锁定：在连线或选中节点时，节点周围会出现淡蓝色的扩散光环 (Halo)。

道路柔光：鼠标悬停道路时，会出现宽阔的淡蓝色光带 (Glow)。

样式：节点由原来的实心圆改为带白色描边的精致圆点，支持阴影投射。

悬浮气泡 (Hover Bubble)：

磨砂玻璃：改为 85% 透明度 的白色背景，配以极细描边和柔和阴影，提升通透感。

位置调整：气泡改为从节点下方弹出，避免遮挡原本位于下方的文字标签。

动画：实现了平滑的淡入淡出和弹性缩放动画。

路径动画：

重写了 highlightPath，移除了头部“诡异的火花”，改为一条纯净、圆角端点的蓝色生长线，底部铺设半透明轨迹。

4. 核心 Bug 修复 (Stability Fixes)
闪退/崩溃修复（重点）：

野指针崩溃：修复了在重绘地图（drawMap）时，后台动画 Lambda 表达式试图访问已删除图形项导致的 Crash。

方案：引入 stopHoverAnimations()，在删除物体前强制停止并销毁动画。

方案：将 HaloItem 和 GlowItem 升级为 QGraphicsObject，利用 Qt 机制自动绑定动画生命周期。

重影/叠层：修复了高频移动鼠标时，旧气泡未消失新气泡就生成导致的堆叠问题。

方案：引入 killDyingItems()，在显示新气泡前强制处决所有残留项。

高频重入：修复了快速移动鼠标导致路径动画卡死或重影的问题。

方案：加入动画防抖逻辑和图形项指针追踪 (activeTrackItem, activeGrowthItem)。

交互 Bug 修复：

文字遮挡：为文字标签设置了 setAcceptedMouseButtons(Qt::NoButton)，实现了点击穿透，解决了文字挡住节点无法连线的问题。

无限缩小：在 wheelEvent 中增加了最小缩放限制，防止地图缩得太小。

属性保存：修复了编辑器中修改“分类”后保存为 "None" 的问题。